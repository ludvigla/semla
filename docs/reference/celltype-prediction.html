<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function can be used to project cell type expression
profiles onto a 10x Visium gene expression matrix to obtain
cell type proportion estimates."><title>Cell type prediction with NNLS — RunNNLS • semla</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Cell type prediction with NNLS — RunNNLS"><meta property="og:description" content="This function can be used to project cell type expression
profiles onto a 10x Visium gene expression matrix to obtain
cell type proportion estimates."><meta property="og:image" content="https://ludvigla.github.io/semla/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">semla</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/semla.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <h6 class="dropdown-header" data-toc-skip>Intro</h6>
    <a class="dropdown-item" href="../articles/getting_started.html">Get started</a>
    <a class="dropdown-item" href="../articles/subset_and_merge.html">Subset/merge</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Interactive</h6>
    <a class="dropdown-item" href="../articles/feature_viewer.html">Feature viewer</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Spatial visualization</h6>
    <a class="dropdown-item" href="../articles/numeric_features.html">Map numeric features</a>
    <a class="dropdown-item" href="../articles/categorical_features.html">Map categorical features</a>
    <a class="dropdown-item" href="../articles/advanced_visualization.html">Advanced visualization</a>
    <a class="dropdown-item" href="../articles/scalebar.html">Scalebar</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Spatial methods</h6>
    <a class="dropdown-item" href="../articles/radial_distances.html">Radial distances</a>
    <a class="dropdown-item" href="../articles/region_neighbors.html">Region neighbors</a>
    <a class="dropdown-item" href="../articles/spatial_statistics_for_labelled_spots.html">Statistics for labelled spots</a>
    <a class="dropdown-item" href="../articles/spatial_autocorrelation.html">Spatial autocorrelation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Analysis</h6>
    <a class="dropdown-item" href="../articles/cell_type_mapping_with_NNLS.html">Cell type mapping</a>
    <a class="dropdown-item" href="../articles/digital_unrolling.html">Digital unrolling</a>
    <a class="dropdown-item" href="../articles/NNMF.html">Non-negative Matrix Factorization</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Image processing</h6>
    <a class="dropdown-item" href="../articles/images_and_coordinates.html">Images and spot coordinates</a>
    <a class="dropdown-item" href="../articles/mask_images.html">Image masking</a>
    <a class="dropdown-item" href="../articles/image_alignment.html">Image alignment</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ludvigla/semla" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Cell type prediction with NNLS</h1>
      
      <div class="d-none name"><code>celltype-prediction.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function can be used to project cell type expression
profiles onto a 10x Visium gene expression matrix to obtain
cell type proportion estimates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">RunNNLS</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for default</span></span>
<span><span class="fu">RunNNLS</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">singlecell_matrix</span>,</span>
<span>  <span class="va">groups</span>,</span>
<span>  nCells_per_group <span class="op">=</span> <span class="fl">50L</span>,</span>
<span>  minCells_per_celltype <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>  min_prop <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  L1 <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1337L</span>,</span>
<span>  return_expression_profiles <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for Seurat</span></span>
<span><span class="fu">RunNNLS</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">singlecell_object</span>,</span>
<span>  groups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  features <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  singlecell_assay <span class="op">=</span> <span class="st">"RNA"</span>,</span>
<span>  spatial_assay <span class="op">=</span> <span class="st">"Spatial"</span>,</span>
<span>  slot <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  min_prop <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  nCells_per_group <span class="op">=</span> <span class="fl">50L</span>,</span>
<span>  minCells_per_celltype <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>  assay_name <span class="op">=</span> <span class="st">"celltypeprops"</span>,</span>
<span>  dimred_name <span class="op">=</span> <span class="st">"nnls"</span>,</span>
<span>  return_as_dimred <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  L1 <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1337L</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>A matrix-like object with 10x Visium data</p></dd>


<dt>...</dt>
<dd><p>Arguments passed to other methods</p></dd>


<dt>singlecell_matrix</dt>
<dd><p>A matrix-like object with scRNA-seq data</p></dd>


<dt>groups</dt>
<dd><p>A character vector of length <code>ncol(singlecell_matrix)</code>
with cell type labels. For <code>Seurat</code> objects, one can omit groups in which case
the current identity is used instead. Alternatively, a string can be provided
specifying a column to use from the <code>singlecell_object</code> meta.data slot.</p></dd>


<dt>nCells_per_group</dt>
<dd><p>Each cell type is down sampled to this number before
computing cell type expression profiles. This is mainly used to speed up
computation. Note that if a cell type has fewer than <code>nCells_per_group</code>
cells, the cells will be sampled with replacement to obtain <code>nCells_per_group</code>
cells.</p></dd>


<dt>minCells_per_celltype</dt>
<dd><p>Minimum number of cells allowed per cell type</p></dd>


<dt>min_prop</dt>
<dd><p>Minimum proportion allowed. Any proportion values lower than
this threshold will be removed and the remaining proportions will be rescaled.</p></dd>


<dt>L1</dt>
<dd><p>lasso penalty</p></dd>


<dt>seed</dt>
<dd><p>An integer to set seed for reproducibility</p></dd>


<dt>return_expression_profiles</dt>
<dd><p>Logical specifying if the expression profile matrix
should also be returned</p></dd>


<dt>verbose</dt>
<dd><p>Print messages</p></dd>


<dt>singlecell_object</dt>
<dd><p>A <code>Seurat</code> object with single-cell gene expression data</p></dd>


<dt>features</dt>
<dd><p>Features to use for computation. If no features are
provided, the intersection of variable features between sc_object and st_object
will be used. Note that the intersect can be quite small, in which case you can
increase the number of variable features by rerunning <code>FindVariableFeatures</code>
and increase the number with the <code>nfeatures</code> argument.</p></dd>


<dt>singlecell_assay</dt>
<dd><p>Assay in single cell data object to use for deconvolution</p></dd>


<dt>spatial_assay</dt>
<dd><p>Assay in Visium data object to use for deconvolution</p></dd>


<dt>slot</dt>
<dd><p>Name of slot in <code>singlecell_assay</code> and <code>spatial_assay</code> to use for
deconvolution</p></dd>


<dt>assay_name</dt>
<dd><p>Sets the name of the returned <code>Assay</code> object. Only active
if return.as.dimred = FALSE.</p></dd>


<dt>dimred_name</dt>
<dd><p>Sets the name of  the returned <code>DimReduc</code> object. Only
active if return.as.dimred = TRUE.</p></dd>


<dt>return_as_dimred</dt>
<dd><p>By default, the results are returned as an <code>Assay</code>
named "celltypeprops", where each feature is named after the cell type IDs.
Alternatively, you can return the results as a <code>DimReduc</code> object. This will
also provide the cell gene loadings for each cell type. However, the proportions
will instead be named "factor_1", "factor_2", ...</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object with cell type proportion estimates</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This method is suitable for
paired 10x Visium and scRNA-seq data. In other words, the
scRNA-seq data should represent the cell types present in
the 10x Visium spatial transcriptomics data.
Redundant cell types (i.e. cells that are present in the
scRNA-seq data but not in the data 10x Visium) or missing
cell types (i.e. cells that are present in the 10x Visium
data but not in the data scRNA-seq data) might affect the
results.</p>
<p>Preferably, the scRNA-seq data should be composed of the
same cell types as the tissue section(s) processed by 10x
Visium and be collected from the same tissue specimen.
This method is intended to be used as a fast cell type
mapping which is useful for data driven exploration.</p>
<p>We encourage users to explore alternative methods such as
stereoscope, cell2location or RCTD.</p>
<p>The method uses the NNLS implementation
from the <code>RcppML</code> R package developed by Zachary DeBruine.</p>
    </div>
    <div class="section level2">
    <h2 id="default-method">default method<a class="anchor" aria-label="anchor" href="#default-method"></a></h2>
    

<p>Input <code>object</code> is a matrix-like object with 10x Visium data. The function returns
a matrix with estimated cell type proportions of dimensions nCellTypes x nSpots,
where nCellTypes is the number of cell types and nSpots is the number of spots.
If `return_expression_profiles=TRUE`, the returned object will be a list with estimated
proportions `prop` and the cell type expression profile matrix `W`.</p>
    </div>
    <div class="section level2">
    <h2 id="seurat-method">Seurat method<a class="anchor" aria-label="anchor" href="#seurat-method"></a></h2>
    

<p>Input <code>object</code> is a <code>Seurat</code> object with 10x Visium data. The function returns
the <code>Seurat</code> object with either a new <code>Assay</code> or <code>DimReduc</code> object containing
estimated cell type proportions.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><a href="https://doi.org/10.1101/2021.09.01.458620" class="external-link">RcppML</a>
<a href="https://github.com/zdebruine/RcppML" class="external-link">RcppML GitHub page</a></p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/ludvigla" class="external-link">Ludvig Larsson</a>, <a href="https://github.com/lfranzen" class="external-link">Lovisa Franzen</a>, <a href="https://www.spatialresearch.org/" class="external-link"><img src="reference/figures/sr-logo.png" height="36" alt="spatialresearch"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

