<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="semla">
<title>Advanced visualization • semla</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Advanced visualization">
<meta property="og:description" content="semla">
<meta property="og:image" content="https://ludvigla.github.io/semla/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">semla</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/semla.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <h6 class="dropdown-header" data-toc-skip>Intro</h6>
    <a class="dropdown-item" href="../articles/getting_started.html">Get started</a>
    <a class="dropdown-item" href="../articles/subset_and_merge.html">Subset/merge</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Interactive</h6>
    <a class="dropdown-item" href="../articles/feature_viewer.html">Feature viewer</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Spatial visualization</h6>
    <a class="dropdown-item" href="../articles/numeric_features.html">Map numeric features</a>
    <a class="dropdown-item" href="../articles/categorical_features.html">Map categorical features</a>
    <a class="dropdown-item" href="../articles/advanced_visualization.html">Advanced visualization</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Spatial methods</h6>
    <a class="dropdown-item" href="../articles/radial_distances.html">Radial distances</a>
    <a class="dropdown-item" href="../articles/region_neighbors.html">Region neighbors</a>
    <a class="dropdown-item" href="../articles/spatial_statistics_for_labelled_spots.html">Statistics for labelled spots</a>
    <a class="dropdown-item" href="../articles/spatial_autocorrelation.html">Spatial autocorrelation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Analysis</h6>
    <a class="dropdown-item" href="../articles/cell_type_mapping_with_NNLS.html">Cell type mapping</a>
    <a class="dropdown-item" href="../articles/digital_unrolling.html">Digital unrolling</a>
    <a class="dropdown-item" href="../articles/NNMF.html">Non-negative Matrix Factorization</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Image processing</h6>
    <a class="dropdown-item" href="../articles/images_and_coordinates.html">Images and spot coordinates</a>
    <a class="dropdown-item" href="../articles/mask_images.html">Image masking</a>
    <a class="dropdown-item" href="../articles/image_alignment.html">Image alignment</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Staffli</h6>
    <a class="dropdown-item" href="../articles/create_object.html">Create Staffli object</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ludvigla/semla" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Advanced visualization</h1>
            
            <h4 data-toc-skip class="date">Last compiled: 25 March
2023</h4>
      
      
      <div class="d-none name"><code>advanced_visualization.Rmd</code></div>
    </div>

    
    
<p>In this tutorial, we’ll have a look at different ways of creating
spatial plots with <code>semla</code>. Functions such as
<code><a href="../reference/visualize-features.html">MapFeatures()</a></code> and <code><a href="../reference/visualize-labels.html">MapLabels()</a></code> produce
patchworks (see R package <a href="https://patchwork.data-imaginist.com/" class="external-link">patchwork</a>) which are
easy to manipulate after they have been created. In addition to these
two fundamental plotting functions, there are also
<code><a href="../reference/MapFeaturesSummary.html">MapFeaturesSummary()</a></code> and <code><a href="../reference/MapLabelsSummary.html">MapLabelsSummary()</a></code>,
which works just as their parent functions but also adds a subplot with
informative summary statistics attached.s</p>
<p>The <code>patchwork</code> R package is extremely versatile and makes
it easy to customize your figures! Here we’ll have a look at some
options that comes with <code>MapFeatures</code> and
<code>MapLabels</code> a couple of tips and tricks for how to use the
<code>patchwork</code> R package.</p>
<p>This tutorial is an extension of the ‘<a href="https://ludvigla.github.io/semla/articles/numeric_features.html">Map
numeric features</a>’ and ‘<a href="https://ludvigla.github.io/semla/articles/categorical_features.html">Map
categorical features</a>’ tutorials. Here you can find more in depth
details about how to manipulate various components of the plots
generated with <code>MapFeatures</code> and <code>MapLabels</code> as
well as some additional plot functions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ludvigla.github.io/semla/">semla</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h2>
<p>First we need to load some 10x Visium data. here we’ll use a mouse
brain tissue dataset and a mouse colon dataset that are shipped with
<code>semla</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load data</span></span>
<span><span class="va">se_mbrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, </span>
<span>                                        <span class="st">"mousebrain/se_mbrain"</span>, </span>
<span>                                        package <span class="op">=</span> <span class="st">"semla"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">se_mbrain</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="st">"mousebrain"</span></span>
<span><span class="va">se_mcolon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, </span>
<span>                                        <span class="st">"mousecolon/se_mcolon"</span>, </span>
<span>                                        package <span class="op">=</span> <span class="st">"semla"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">se_mcolon</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="st">"mousecolon"</span></span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge.html">MergeSTData</a></span><span class="op">(</span><span class="va">se_mbrain</span>, <span class="va">se_mcolon</span><span class="op">)</span></span></code></pre></div>
<p>We can use the functions <code>MapFeatures</code> and
<code>MapLabels</code> to make spatial plots showing the distribution of
numeric or categorical features. For those who are familiar with
<code>Seurat</code>, these functions are similar to
<code>SpatialFeaturePlot</code> and <code>SpatialDimPlot</code> in the
sense that the first can be used to visualize numeric data and the
latter can be used to color data points based on categorical data.</p>
</div>
<div class="section level2">
<h2 id="map-numeric-features">Map numeric features<a class="anchor" aria-label="anchor" href="#map-numeric-features"></a>
</h2>
<p>Let’s get started with <code>MapFeatures</code>. The most basic usage
is to map gene expression spatially:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">rocket</a></span><span class="op">(</span><span class="fl">11</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, colors <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="section level3">
<h3 id="summary-subplot">Summary subplot<a class="anchor" aria-label="anchor" href="#summary-subplot"></a>
</h3>
<p>We can also use the function <code>MapFeaturesSummary</code> to add a
subplot next to the spatial plot summarizing the gene expression in the
section using either a box plot, a violin plot, a histogram, or a
density plot.</p>
<p>This function only takes one gene at the time, but you can patch two
plots together manually if desired.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MapFeaturesSummary.html">MapFeaturesSummary</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                        features <span class="op">=</span> <span class="st">"Clu"</span>, </span>
<span>                        subplot_type <span class="op">=</span> <span class="st">"violin"</span>, </span>
<span>                        colors <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MapFeaturesSummary.html">MapFeaturesSummary</a></span><span class="op">(</span><span class="va">se</span>,</span>
<span>                         section_number <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         features <span class="op">=</span> <span class="st">"Clu"</span>, </span>
<span>                         subplot_type <span class="op">=</span> <span class="st">"box"</span>, </span>
<span>                         colors <span class="op">=</span> <span class="va">cols</span>, </span>
<span>                         fill_color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MapFeaturesSummary.html">MapFeaturesSummary</a></span><span class="op">(</span><span class="va">se</span>,</span>
<span>                         section_number <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         features <span class="op">=</span> <span class="st">"Clu"</span>, </span>
<span>                         subplot_type <span class="op">=</span> <span class="st">"histogram"</span>, </span>
<span>                         colors <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span><span class="va">p1</span><span class="op">|</span><span class="va">p2</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Clu"</span>, <span class="st">"Apod"</span>, <span class="st">"Cd79a"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">genes_to_plot</span>, <span class="kw">function</span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/MapFeaturesSummary.html">MapFeaturesSummary</a></span><span class="op">(</span><span class="va">se</span>,</span>
<span>                     section_number <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                     features <span class="op">=</span> <span class="va">g</span>, </span>
<span>                     subplot_type <span class="op">=</span> <span class="st">"density"</span>, </span>
<span>                     pt_size <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                     colors <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">plot_list</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-6-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="overlay-maps-on-images">Overlay maps on images<a class="anchor" aria-label="anchor" href="#overlay-maps-on-images"></a>
</h3>
<p>If we want to create a map with the H&amp;E images we can do this by
setting <code>image_use = raw</code>. But before we can do this, we need
to load the images into our <em>Seurat</em> object:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cols_he</span> <span class="op">&lt;-</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load-images.html">LoadImages</a></span><span class="op">(</span><span class="va">se</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>                 colors <span class="op">=</span> <span class="va">cols_he</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Right now it’s quite difficult to see the tissue underneath the
spots. We can add some opacity to the colors which is scaled by the
feature values to make spots with low expression transparent:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 image_use <span class="op">=</span> <span class="st">"raw"</span>,</span>
<span>                 colors <span class="op">=</span> <span class="va">cols_he</span>, </span>
<span>                 scale_alpha <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="transpose-patchwork-layout">Transpose patchwork layout<a class="anchor" aria-label="anchor" href="#transpose-patchwork-layout"></a>
</h3>
<p>By default, <code>MapFeatures</code> arranges features in columns and
samples in rows. We can transpose the plot by setting
<code>arrange_features</code> to “row”:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 arrange_features <span class="op">=</span> <span class="st">"row"</span>, </span>
<span>                 color <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="independent-color-bars">Independent color bars<a class="anchor" aria-label="anchor" href="#independent-color-bars"></a>
</h3>
<p>The color bars are now identical for each feature.
<code>MapFeatures</code> calculates the range for each feature and uses
this range to determine the limits of the color bars. If you want to
change this behavior to scale the values independently, you can set
<code>scale = "free"</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 scale <span class="op">=</span> <span class="st">"free"</span>, </span>
<span>                 colors <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="fit-plot-area-to-spots">Fit plot area to spots<a class="anchor" aria-label="anchor" href="#fit-plot-area-to-spots"></a>
</h3>
<p><code>MapFeatures</code> used the image dimensions to define the plot
area dimensions. Sometimes, if you have a very small piece of tissue,
you will end up with a lot of white space. You can override this
behavior by setting <code>override_plot_dims = TRUE</code> which will
make <code>MapFeatures</code> compute the dimensions based on your
coordinates. Notice how the tissues are expanded:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 color <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="controlling-themes">Controlling themes<a class="anchor" aria-label="anchor" href="#controlling-themes"></a>
</h3>
<p>Themes can be modified by adding a new ggplot theme using the
<code>&amp;</code> operator. This operator will make sure that the theme
is added to each subplot in our patchwork. As an example, let’s say that
we want to place the legends on the right side of our plots instead:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>We can also remove the color legends entirely:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, colors <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Or remove everything except the spatial feature map:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, colors <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="collect-color-bars">Collect color bars<a class="anchor" aria-label="anchor" href="#collect-color-bars"></a>
</h3>
<p>If we don’t want to have the same color bar next to each tissue
section, we can collect identical color bars and place them on the side.
We can use <code>plot_layout(guides = "collect")</code> to modify this.
Note that if we want to place the color bar on the right side of the
plots, we need to set <code>arrange_features = "row"</code>` and adjust
the legend position:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 arrange_features <span class="op">=</span> <span class="st">"row"</span>, </span>
<span>                 colors <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>This already looks quite good, but the color bars are a bit
misplaced. We can adjust their placement by modifying the legend
margins:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 arrange_features <span class="op">=</span> <span class="st">"row"</span>, </span>
<span>                 color <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, </span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>        legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">50</span>, r <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">100</span>, l <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="section level4">
<h4 id="do-not-do-this">Do not do this<a class="anchor" aria-label="anchor" href="#do-not-do-this"></a>
</h4>
<p>If we set <code>scale = "free"</code>, the color bars are no longer
unique and it doesn’t make sense to collect the color bars anymore:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 arrange_features <span class="op">=</span> <span class="st">"row"</span>, </span>
<span>                 scale <span class="op">=</span> <span class="st">"free"</span>, </span>
<span>                 colors <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, </span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>        legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">50</span>, r <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">100</span>, l <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="do-not-do-this-either">Do not do this either<a class="anchor" aria-label="anchor" href="#do-not-do-this-either"></a>
</h4>
<p>If we set <code>arrange_features = "col"</code>, the placement of the
color bar will not make sense in this case either. The color bars are
now located on the right side, but the features are arranged by row:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 arrange_features <span class="op">=</span> <span class="st">"col"</span>, </span>
<span>                 colors <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, </span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>        legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">50</span>, r <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">100</span>, l <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Instead, if we want to arrange features by columns, it would make
more sense to place the color bars on top of each column and adjust the
legend margins accordingly:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 arrange_features <span class="op">=</span> <span class="st">"col"</span>, </span>
<span>                 color <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, </span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>        legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">0</span>, r <span class="op">=</span> <span class="fl">100</span>, b <span class="op">=</span> <span class="fl">0</span>, l <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="remove-plot-margins">Remove plot margins<a class="anchor" aria-label="anchor" href="#remove-plot-margins"></a>
</h3>
<p>If you still think that there’s too much empty space around the
tissues in the patchwork, you try setting
<code>override_plot_dims = TRUE</code> which will crop the plot area to
only fit the spots:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 color <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="crop">Crop<a class="anchor" aria-label="anchor" href="#crop"></a>
</h3>
<p>H&amp;E images will also be cropped to fit the new plot dimensions if
<code>override_plot_dims = TRUE</code>. This can be particularly useful
when working with small tissue sections that only cover a small portion
of the 10x Visium capture area.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>                 override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 color <span class="op">=</span> <span class="va">cols_he</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>Note that the plots dimensions are calculated for the entire dataset
when <code>override_plot_dims = TRUE</code>.</p>
<p>If the tissue sections are placed in very different part of the
capture area, the resulting “crop” window might not be what you are
looking for. If you want to avoid this behavior, it is better to make
two separate plots. Notice the difference in the plot below compared to
the previous plot. The previous plot had some empty space outside of the
tissue.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                  features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                  image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>                  override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                  color <span class="op">=</span> <span class="va">cols_he</span>, </span>
<span>                  section_number <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                  features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                  image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>                  override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                  color <span class="op">=</span> <span class="va">cols_he</span>, </span>
<span>                  section_number <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>We can also crop the images manually by defining a
<code>crop_area</code>. The <code>crop_area</code> should be a vector of
length four defining the corners of a rectangle, where the x- and y-axes
are defined from 0-1.</p>
<p>In order to decide how this rectangle should be defined, you can get
some help by adding a grid to the plot:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>                 color <span class="op">=</span> <span class="va">cols_he</span>, </span>
<span>                 pt_alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span>, axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>Now if we want to crop out the GALT tissue in the mouse colon sample
we can cut the image at left=0.45, bottom=0.55, right=0.65, top=0.7:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cd79a"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                 image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>                 pt_size <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                 section_number <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                 color <span class="op">=</span> <span class="va">cols_he</span>, </span>
<span>                 crop_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.45</span>, <span class="fl">0.55</span>, <span class="fl">0.65</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<p>And we can patch together a nice figure showing the expression both
at a global level and inside the GALT:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_global</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                        features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cd79a"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                        image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>                        scale_alpha <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        pt_size <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                        section_number <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                        color <span class="op">=</span> <span class="va">cols_he</span>, </span>
<span>                        override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p_GALT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                      features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cd79a"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                      image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>                      scale_alpha <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                      pt_size <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                      section_number <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                      color <span class="op">=</span> <span class="va">cols_he</span>, </span>
<span>                      crop_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.45</span>, <span class="fl">0.55</span>, <span class="fl">0.65</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">p_global</span> <span class="op">/</span> <span class="va">p_GALT</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="increase-resolution">Increase resolution<a class="anchor" aria-label="anchor" href="#increase-resolution"></a>
</h3>
<p>Right now, you can see that the resolution of zoomed in image is
quite low. The reason for this is that the images were loaded to have a
height of 400 pixels which is the default setting for
<code>LoadImages</code>. If you want to, you can reload the images in
higher resolution given that you provided higher resolution images as
input. For example, if you used the “tissue_hires_image.png” files as
input for <code>ReadVisiumData</code>, these images are roughly
2000x2000 pixels in size, so you can reload the images in higher
resolution. If we run <code>LoadImages</code> again and set
<code>image_height = 1000</code> we should be able to view the H%&amp;E
images in slightly higher resolution.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se_high_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load-images.html">LoadImages</a></span><span class="op">(</span><span class="va">se</span>, image_height <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Loading H&amp;E images</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Loading image from /private/var/folders/zb/1fj07x_5343fvs_k28gnm1z80002xs/T/RtmpGMeJsM/temp_libpathe1182c30b153/semla/extdata/mousebrain/spatial/tissue_hires_image.jpg</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Scaled image from 2000x1882 to 1000x941 pixels</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Loading image from /private/var/folders/zb/1fj07x_5343fvs_k28gnm1z80002xs/T/RtmpGMeJsM/temp_libpathe1182c30b153/semla/extdata/mousecolon/spatial/tissue_hires_image.jpg</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Scaled image from 1804x2000 to 1000x1109 pixels</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Saving loaded H&amp;E images as 'rasters' in Seurat object</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check object sizes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 15.8 Mb</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">se_high_res</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 39.2 Mb</span></span></code></pre>
<p>Note that these higher resolution images will take up more space and
might slow down the plotting considerably.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_global</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se_high_res</span>, </span>
<span>                        features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cd79a"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                        image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>                        scale_alpha <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        pt_size <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                        section_number <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                        color <span class="op">=</span> <span class="va">cols_he</span>, </span>
<span>                        override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p_GALT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se_high_res</span>, </span>
<span>                      features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cd79a"</span>, <span class="st">"Clu"</span><span class="op">)</span>, </span>
<span>                      image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>                      scale_alpha <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                      pt_size <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                      section_number <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                      color <span class="op">=</span> <span class="va">cols_he</span>, </span>
<span>                      crop_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.45</span>, <span class="fl">0.55</span>, <span class="fl">0.65</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">p_global</span> <span class="op">/</span> <span class="va">p_GALT</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="map-categorical-features">Map categorical features<a class="anchor" aria-label="anchor" href="#map-categorical-features"></a>
</h2>
<p>For categorical data, we use <code><a href="../reference/visualize-labels.html">MapLabels()</a></code> instead of
<code><a href="../reference/visualize-features.html">MapFeatures()</a></code>. This function allows us to color our spots
based on some column of our Seurat object containing categorical
data.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se</span>, column_name <span class="op">=</span> <span class="st">"sample_id"</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<div class="section level3">
<h3 id="order-of-categories">Order of categories<a class="anchor" aria-label="anchor" href="#order-of-categories"></a>
</h3>
<p>Categorical data can be represented as character vectors or factors,
but with factors it’s easier to control the order of the labels as well
as their colors. If we want to customize the order, we can convert our
column into a factor and set the levels as we please:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span><span class="op">$</span><span class="va">sample_id_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">se</span><span class="op">$</span><span class="va">sample_id</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mousecolon"</span>, <span class="st">"mousebrain"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se</span>, column_name <span class="op">=</span> <span class="st">"sample_id_factor"</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="colors">Colors<a class="anchor" aria-label="anchor" href="#colors"></a>
</h3>
<p>If we pass a named vector of colors we can control the coloring of
our labels:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se</span>, column_name <span class="op">=</span> <span class="st">"sample_id_factor"</span>, ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>          colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mousecolon"</span> <span class="op">=</span> <span class="st">"#4477AA"</span>, <span class="st">"mousebrain"</span> <span class="op">=</span> <span class="st">"#CC6677"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<p>Let’s run unsupervised clustering on our data to get slightly more
interesting results to work with.</p>
<p>NB: It doesn’t make much sense to run data-driven clustering on two
completely different tissue types, but here we are only interested in
demonstrating how you can use <code>MapLabels</code>.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span> <span class="op">&lt;-</span> <span class="va">se</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html" class="external-link">NormalizeData</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html" class="external-link">ScaleData</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">FindVariableFeatures</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html" class="external-link">RunPCA</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html" class="external-link">FindNeighbors</a></span><span class="op">(</span>reduction <span class="op">=</span> <span class="st">"pca"</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html" class="external-link">FindClusters</a></span><span class="op">(</span>resolution <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of nodes: 5164</span></span>
<span><span class="co">## Number of edges: 170850</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Running Louvain algorithm...</span></span>
<span><span class="co">## Maximum modularity in 10 random starts: 0.9210</span></span>
<span><span class="co">## Number of communities: 5</span></span>
<span><span class="co">## Elapsed time: 0 seconds</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="map-clusters">Map clusters<a class="anchor" aria-label="anchor" href="#map-clusters"></a>
</h3>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se</span>, column_name <span class="op">=</span> <span class="st">"seurat_clusters"</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="summary-subplot-1">Summary subplot<a class="anchor" aria-label="anchor" href="#summary-subplot-1"></a>
</h3>
<p>Similarly to <code><a href="../reference/MapFeaturesSummary.html">MapFeaturesSummary()</a></code>, we also have
<code><a href="../reference/MapLabelsSummary.html">MapLabelsSummary()</a></code>, which adds a stacked barchart
displaying the cluster proportion (percentage) in the section. Passing
<code>bar_display = "count"</code> will instead show the actual spot
count per cluster.</p>
<p>Let’s combine <code>MapLabelsSummary</code> with some custom cluster
colors.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">se</span><span class="op">$</span><span class="va">seurat_clusters</span><span class="op">)</span><span class="op">)</span>, <span class="st">"Set1"</span><span class="op">)</span>, </span>
<span>                           nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">se</span><span class="op">$</span><span class="va">seurat_clusters</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/MapLabelsSummary.html">MapLabelsSummary</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 column_name <span class="op">=</span> <span class="st">"seurat_clusters"</span>, </span>
<span>                 ncol <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                 colors <span class="op">=</span> <span class="va">cluster_colors</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<p>We can adjust a few things, like width and text size, on the bar plot
with the arguments <code>bar_width</code> and
<code>bar_label_size</code>.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/MapLabelsSummary.html">MapLabelsSummary</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>                 column_name <span class="op">=</span> <span class="st">"seurat_clusters"</span>,</span>
<span>                 section_number <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                 label_by <span class="op">=</span> <span class="st">"sample_id"</span>,</span>
<span>                 colors <span class="op">=</span> <span class="va">cluster_colors</span>,</span>
<span>                 pt_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                 bar_display <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>                 bar_width <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                 bar_label_size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust<span class="op">=</span><span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="format-legend">Format legend<a class="anchor" aria-label="anchor" href="#format-legend"></a>
</h3>
<div class="section level4">
<h4 id="point-size">Point size<a class="anchor" aria-label="anchor" href="#point-size"></a>
</h4>
<p>If you want to increase the size of the spots in the color legend,
you can override the <code>fill</code> aesthetic that controls the
appearance of the points without changing the size of the points in the
plot. We can do this by using
<code>guides(fill = guide_legend(override.aes = list(size = ...)))</code>:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>          column_name <span class="op">=</span> <span class="st">"seurat_clusters"</span>, </span>
<span>          ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>          colors <span class="op">=</span> <span class="va">cluster_colors</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="legend-arrangement">Legend arrangement<a class="anchor" aria-label="anchor" href="#legend-arrangement"></a>
</h4>
<p>Another useful option is to adjust the arrangement of the color
legend. For example, if you have a lot of different categories, it might
be easier to read the labels if they are arranged in multiple
columns:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>          column_name <span class="op">=</span> <span class="st">"seurat_clusters"</span>, </span>
<span>          ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>          colors <span class="op">=</span> <span class="va">cluster_colors</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>                             ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="collect-legends">Collect legends<a class="anchor" aria-label="anchor" href="#collect-legends"></a>
</h4>
<p>Since all sub plots share the same color legends, we can collect them
and place them on the side of the plot:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>          column_name <span class="op">=</span> <span class="st">"seurat_clusters"</span>, </span>
<span>          ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>          colors <span class="op">=</span> <span class="va">cluster_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>                             ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-37-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="overlay-maps-on-images-1">Overlay maps on images<a class="anchor" aria-label="anchor" href="#overlay-maps-on-images-1"></a>
</h3>
<p>And just as with <code>MapFeatures</code>, we can add our H&amp;E
images to the plots:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>          column_name <span class="op">=</span> <span class="st">"seurat_clusters"</span>, </span>
<span>          image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>          override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>          pt_alpha <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>          colors <span class="op">=</span> <span class="va">cluster_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>                             ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-38-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="split-labels">Split labels<a class="anchor" aria-label="anchor" href="#split-labels"></a>
</h3>
<p>Sometimes it can get cluttered in the plot and difficult to see where
each cluster is located in the tissue, especially when there are many
clusters and some of them have very similar colors. In this case,
<code>MapLabels</code> can split the data into separate panels, one for
each label:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>          column_name <span class="op">=</span> <span class="st">"seurat_clusters"</span>, </span>
<span>          split_labels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          colors <span class="op">=</span> <span class="va">cluster_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, </span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>,<span class="op">-</span><span class="fl">10</span>,<span class="op">-</span><span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: No section_number selected. Selecting section 1.</span></span></code></pre>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-39-1.png" width="700"></p>
<p>When you split data, you can only do it for one section which is why
a warning is thrown and the first available section is selected. If you
want to use a different section, you can specify which one to use with
<code>section_number</code>:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>          column_name <span class="op">=</span> <span class="st">"seurat_clusters"</span>, </span>
<span>          split_labels <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>          section_number <span class="op">=</span> <span class="fl">2</span>, </span>
<span>          ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>          colors <span class="op">=</span> <span class="va">cluster_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-40-1.png" width="700"></p>
<div class="section level4">
<h4 id="remove-background">Remove background<a class="anchor" aria-label="anchor" href="#remove-background"></a>
</h4>
<p>When mapping categorical features in split view it might be more
useful to see the underlying image. If you set
<code>drop_na = TRUE</code>, the background spots will be removed:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se</span>, </span>
<span>          column_name <span class="op">=</span> <span class="st">"seurat_clusters"</span>, </span>
<span>          split_labels <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>          image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>          drop_na <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>          override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          colors <span class="op">=</span> <span class="va">cluster_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, </span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: No section_number selected. Selecting section 1.</span></span></code></pre>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-41-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="scale-bars">Scale bars<a class="anchor" aria-label="anchor" href="#scale-bars"></a>
</h2>
<p>To add a scalebar, simply set <code>add_scalebar = TRUE</code> and
the scalebar should appear in the top right corner.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se_mbrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load-images.html">LoadImages</a></span><span class="op">(</span><span class="va">se_mbrain</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Loading H&amp;E images</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Loading image from /private/var/folders/zb/1fj07x_5343fvs_k28gnm1z80002xs/T/RtmpGMeJsM/temp_libpathe1182c30b153/semla/extdata/mousebrain/spatial/tissue_hires_image.jpg</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Scaled image from 2000x1882 to 400x376 pixels</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Saving loaded H&amp;E images as 'rasters' in Seurat object</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se_mbrain</span>, features <span class="op">=</span> <span class="st">"nFeature_Spatial"</span>, pt_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span>, image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>            add_scalebar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required namespace: ggfittext</span></span></code></pre>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-42-1.png" width="480"></p>
<p>And with <code>mapLabels</code>:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se_mbrain</span>, column_name <span class="op">=</span> <span class="st">"sample_id"</span>, pt_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>          override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span>, image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>          add_scalebar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-43-1.png" width="480"></p>
<p>You can also tweak the appearance and position of the scalebar with
<code>scalebar_gg</code>, <code>scalebar_position</code> and
<code>scalebar_height</code>.</p>
<ul>
<li>
<code>scalebar_gg</code> allows you to modify the width and breaks
of the scalebar. The title of the scalebar will be adjusted from
micrometers to millimeters if x &gt; 1000.</li>
<li>
<code>scalebar_position</code> sets the position of the scalebar
relative to the entire plot.</li>
<li>
<code>scalebar_height</code> can be useful to adjust the height of
the scalebar to make the text fit. If the scalebar is too small, for
instance when plotting many sections at once, increasing the height will
make the text appear.</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-labels.html">MapLabels</a></span><span class="op">(</span><span class="va">se_mbrain</span>, column_name <span class="op">=</span> <span class="st">"sample_id"</span>, pt_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>          image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>          add_scalebar <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>          scalebar_gg <span class="op">=</span> <span class="fu"><a href="../reference/scalebar.html">scalebar</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2000</span>, breaks <span class="op">=</span> <span class="fl">11</span>, highlight_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          scalebar_position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.55</span>, <span class="fl">0.7</span><span class="op">)</span>, </span>
<span>          scalebar_height <span class="op">=</span> <span class="fl">0.07</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-44-1.png" width="480"></p>
<p>Here’s another example with image masking:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Mask image</span></span>
<span><span class="va">se_mbrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask-images.html">MaskImages</a></span><span class="op">(</span><span class="va">se_mbrain</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se_mbrain</span>, features <span class="op">=</span> <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/VariableFeatures.html" class="external-link">VariableFeatures</a></span><span class="op">(</span><span class="va">se_mbrain</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>          image_use <span class="op">=</span> <span class="st">"raw"</span>, </span>
<span>          add_scalebar <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>          scale_alpha <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          scalebar_gg <span class="op">=</span> <span class="fu"><a href="../reference/scalebar.html">scalebar</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,</span>
<span>          scalebar_position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.55</span>, <span class="fl">0.88</span><span class="op">)</span>,</span>
<span>          scalebar_height <span class="op">=</span> <span class="fl">0.14</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        legend.position <span class="op">=</span> <span class="st">"right"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-45-1.png" width="768"></p>
<p>If you want to crop the data, you might want to adjust the width
scalebar to a more appropriate length:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se_mbrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load-images.html">LoadImages</a></span><span class="op">(</span><span class="va">se_mbrain</span>, image_height <span class="op">=</span> <span class="fl">1.5e3</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se_mbrain</span>, features <span class="op">=</span> <span class="st">"Th"</span>, pt_size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>            image_use <span class="op">=</span> <span class="st">"raw"</span>, scale_alpha <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            colors <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">11</span>, name <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            crop_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.75</span><span class="op">)</span>,</span>
<span>            scalebar_position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.8</span><span class="op">)</span>, scalebar_height <span class="op">=</span> <span class="fl">0.08</span>,</span>
<span>            add_scalebar <span class="op">=</span> <span class="cn">TRUE</span>, scalebar_gg <span class="op">=</span> <span class="fu"><a href="../reference/scalebar.html">scalebar</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">400</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-46-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="rearrange-patchworks">Rearrange patchworks<a class="anchor" aria-label="anchor" href="#rearrange-patchworks"></a>
</h2>
<p>While <code>MapLabels</code> and <code>MapFeatures</code> do not
provide arguments to sort samples in a specific order, this can be
achieved by returning the data as a list of <code>ggplot</code> objects
and define the order manually.</p>
<p>For instance, if we have plot two features and set
<code>return_plot_list = TRUE</code>, we can rearrange the plots with
<code>wrap_plots</code>:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se_mbrain</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Calb2"</span><span class="op">)</span>, return_plot_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">`1`</span><span class="op">$</span><span class="va">Calb2</span>, <span class="va">p</span><span class="op">$</span><span class="va">`1`</span><span class="op">$</span><span class="va">Th</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-47-1.png" width="700"></p>
<p>If we have multiple sections, we can access the section-specific
plots from the list. In the example below, the plots have been
rearranged so that the columns and rows are flipped.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Calb2"</span><span class="op">)</span>, return_plot_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">`2`</span><span class="op">$</span><span class="va">Calb2</span>, <span class="va">p</span><span class="op">$</span><span class="va">`2`</span><span class="op">$</span><span class="va">Th</span>, <span class="va">p</span><span class="op">$</span><span class="va">`1`</span><span class="op">$</span><span class="va">Th</span>, <span class="va">p</span><span class="op">$</span><span class="va">`1`</span><span class="op">$</span><span class="va">Calb2</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="basic-themes-and-plot-annotation">Basic themes and plot annotation<a class="anchor" aria-label="anchor" href="#basic-themes-and-plot-annotation"></a>
</h2>
<p><code>semla</code> also provides a couple of utility functions to
make it easier to modify themes.</p>
<p>If you are plotting many features and sections at the same time, it
can be useful to remove all components of the theme with
<code>ThemeClean</code> to get a quick overview:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Calb2"</span>, <span class="st">"Clu"</span>, <span class="st">"Mgp"</span>, <span class="st">"Acta2"</span>, <span class="st">"Tagln"</span><span class="op">)</span>, </span>
<span>            override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span>, pt_size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="fu"><a href="../reference/ThemeClean.html">ThemeClean</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-49-1.png" width="700"></p>
<p>If you like to move the color legends to the right hand side of the
plots, you can use <code>ThemeLegendRight</code>:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Calb2"</span><span class="op">)</span>, </span>
<span>            override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="fu"><a href="../reference/ThemeLegendRight.html">ThemeLegendRight</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-50-1.png" width="700"></p>
<p>The titles of individual plots are determined internally by
<code>MapLabels</code> and <code>MapFeatures</code> and it can be
difficult to change these titles after the plot has been generated.
<code>ModifyPatchworkTitles</code> can help with this task. All you need
to do is to provide a character vector with new titles which should
match the number of subplots in the patchwork. In the example below we
have 2 genes and 2 sections, so we need to provide 4 titles:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize-features.html">MapFeatures</a></span><span class="op">(</span><span class="va">se</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Th"</span>, <span class="st">"Calb2"</span><span class="op">)</span>, override_plot_dims <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ModifyPatchworkTitles.html">ModifyPatchworkTitles</a></span><span class="op">(</span><span class="va">p</span>, titles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"First"</span>, <span class="st">"Second"</span>, <span class="st">"Third"</span>, <span class="st">"Fourth"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_visualization_files/figure-html/unnamed-chunk-51-1.png" width="700"></p>
<p><br></p>
<hr>
<details open><summary><strong>Package version</strong>
</summary><ul>
<li>
<code>semla</code>: 1.0.0</li>
</ul></details><details><summary><strong>Session info</strong>
</summary><div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.2.1 (2022-06-23)</span></span>
<span><span class="co">## Platform: x86_64-apple-darwin13.4.0 (64-bit)</span></span>
<span><span class="co">## Running under: macOS Big Sur ... 10.16</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS/LAPACK: /Users/ludviglarsson/miniconda3/envs/R4.2/lib/libopenblasp-r0.3.21.dylib</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] patchwork_1.1.2    tibble_3.1.8       semla_1.0.0        ggplot2_3.4.1     </span></span>
<span><span class="co">## [5] dplyr_1.1.0        SeuratObject_4.1.3 Seurat_4.3.0      </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] Rtsne_0.16             colorspace_2.0-3       deldir_1.0-6          </span></span>
<span><span class="co">##   [4] ellipsis_0.3.2         ggridges_0.5.3         rprojroot_2.0.3       </span></span>
<span><span class="co">##   [7] fs_1.5.2               spatstat.data_3.0-0    rstudioapi_0.14       </span></span>
<span><span class="co">##  [10] farver_2.1.1           leiden_0.4.2           listenv_0.8.0         </span></span>
<span><span class="co">##  [13] ggfittext_0.9.1        ggrepel_0.9.3          fansi_1.0.3           </span></span>
<span><span class="co">##  [16] codetools_0.2-18       splines_4.2.1          cachem_1.0.6          </span></span>
<span><span class="co">##  [19] knitr_1.39             zeallot_0.1.0          polyclip_1.10-0       </span></span>
<span><span class="co">##  [22] jsonlite_1.8.3         ica_1.0-3              cluster_2.1.4         </span></span>
<span><span class="co">##  [25] png_0.1-7              uwot_0.1.14            spatstat.sparse_3.0-0 </span></span>
<span><span class="co">##  [28] shiny_1.7.4            sctransform_0.3.5      compiler_4.2.1        </span></span>
<span><span class="co">##  [31] httr_1.4.4             Matrix_1.5-3           fastmap_1.1.0         </span></span>
<span><span class="co">##  [34] lazyeval_0.2.2         cli_3.4.1              later_1.3.0           </span></span>
<span><span class="co">##  [37] htmltools_0.5.4        tools_4.2.1            igraph_1.3.4          </span></span>
<span><span class="co">##  [40] gtable_0.3.0           glue_1.6.2             RANN_2.6.1            </span></span>
<span><span class="co">##  [43] reshape2_1.4.4         Rcpp_1.0.9             scattermore_0.8       </span></span>
<span><span class="co">##  [46] jquerylib_0.1.4        pkgdown_2.0.6          vctrs_0.5.2           </span></span>
<span><span class="co">##  [49] nlme_3.1-159           spatstat.explore_3.0-5 progressr_0.10.1      </span></span>
<span><span class="co">##  [52] lmtest_0.9-40          spatstat.random_3.0-1  xfun_0.32             </span></span>
<span><span class="co">##  [55] stringr_1.5.0          globals_0.16.0         mime_0.12             </span></span>
<span><span class="co">##  [58] miniUI_0.1.1.1         lifecycle_1.0.3        irlba_2.3.5           </span></span>
<span><span class="co">##  [61] goftest_1.2-3          future_1.27.0          MASS_7.3-58.1         </span></span>
<span><span class="co">##  [64] zoo_1.8-10             scales_1.2.1           ragg_1.2.2            </span></span>
<span><span class="co">##  [67] promises_1.2.0.1       spatstat.utils_3.0-1   parallel_4.2.1        </span></span>
<span><span class="co">##  [70] RColorBrewer_1.1-3     yaml_2.3.5             memoise_2.0.1         </span></span>
<span><span class="co">##  [73] reticulate_1.26        pbapply_1.5-0          gridExtra_2.3         </span></span>
<span><span class="co">##  [76] sass_0.4.2             stringi_1.7.8          highr_0.9             </span></span>
<span><span class="co">##  [79] desc_1.4.1             rlang_1.0.6            pkgconfig_2.0.3       </span></span>
<span><span class="co">##  [82] systemfonts_1.0.4      matrixStats_0.62.0     evaluate_0.16         </span></span>
<span><span class="co">##  [85] lattice_0.20-45        tensor_1.5             ROCR_1.0-11           </span></span>
<span><span class="co">##  [88] purrr_1.0.1            labeling_0.4.2         htmlwidgets_1.5.4     </span></span>
<span><span class="co">##  [91] cowplot_1.1.1          tidyselect_1.2.0       parallelly_1.32.1     </span></span>
<span><span class="co">##  [94] RcppAnnoy_0.0.19       plyr_1.8.7             magrittr_2.0.3        </span></span>
<span><span class="co">##  [97] R6_2.5.1               magick_2.7.3           generics_0.1.3        </span></span>
<span><span class="co">## [100] withr_2.5.0            pillar_1.8.1           fitdistrplus_1.1-8    </span></span>
<span><span class="co">## [103] abind_1.4-5            survival_3.4-0         sp_1.5-1              </span></span>
<span><span class="co">## [106] future.apply_1.9.0     KernSmooth_2.23-20     utf8_1.2.2            </span></span>
<span><span class="co">## [109] spatstat.geom_3.0-3    plotly_4.10.0          rmarkdown_2.15        </span></span>
<span><span class="co">## [112] viridis_0.6.2          grid_4.2.1             data.table_1.14.2     </span></span>
<span><span class="co">## [115] forcats_0.5.2          digest_0.6.29          xtable_1.8-4          </span></span>
<span><span class="co">## [118] dbscan_1.1-10          tidyr_1.3.0            httpuv_1.6.5          </span></span>
<span><span class="co">## [121] textshaping_0.3.6      munsell_0.5.0          viridisLite_0.4.1     </span></span>
<span><span class="co">## [124] bslib_0.4.0            shinyjs_2.1.0</span></span></code></pre>
</details><p><br></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/ludvigla" class="external-link">Ludvig Larsson</a>, <a href="https://github.com/lfranzen" class="external-link">Lovisa Franzen</a>, <a href="https://www.spatialresearch.org/" class="external-link"><img src="reference/figures/sr-logo.png" height="36" alt="spatialresearch"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
